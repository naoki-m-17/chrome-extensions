# RaycastのQuicklinkでGeminiを使いたい！

Gemini (gemini.google.com) のWeb版において、公式でサポートされていないURLクエリパラメータによるプロンプト入力を可能にするChrome拡張機能です。

## 開発の背景
RaycastのQuicklinksなど、外部ツールからAIモデルへ即座にアクセスする際、ChatGPTやPerplexityはURLパラメータをサポートしていますが、Geminiにはその機能がありません。
ブラウザでのAI利用においてGeminiを好むエンジニアが、入力をショートカット化してワークフローを高速化するために開発しました。

## 機能
- **シームレスなプロンプト注入**: `https://gemini.google.com/app?q=あなたの質問` というURLでアクセスすると、自動的に入力欄にプロンプトが注入されます。
- **全自動送信**: 入力後、アプリの状態（State）の更新を考慮したリトライロジックにより、自動で送信まで完結させます。
- **URLクリーンアップ**: 送信完了後、Gemini側のルーティング確定を待ってからURLクエリパラメータを削除（`history.replaceState`）し、履歴の汚染やリロード時の二重送信を防止します。

## 技術的特徴（エンジニア向け）
- **UI構造の変化に強い非依存設計**: 
    - 送信ボタン等の特定のDOM要素取得は、将来的なUI変更（クラス名や構造の変化）に弱いため採用していません。
    - 入力欄に対する「Enterキーイベントのシミュレーション」と「入力内容の残存チェック」を組み合わせたリトライアルゴリズムにより、ボタンの有無に関わらず送信を確実にトリガーします。
- **パフォーマンス最適化**: 
    - `manifest.json` で `run_at: "document_start"` を指定。
    - パラメータ `q` が存在しない場合は即座に処理を終了（アーリーリターン）させることで、ブラウザへの負荷を最小限に抑えています。
- **堅牢なSPA対応**: 
    - GeminiのようなSPAでのDOM生成タイミングを考慮し、`setInterval` によるポーリング実装を採用。
    - 単なる `innerText` の書き換えだけでなく、`input` イベントを明示的にディスパッチすることで、内部フレームワーク（React/Angular等）の状態更新を確実に同期させています。
- **非同期クリーンアップ**:
    - Gemini側のURL確定処理（会話IDの付与等）との競合を避けるため、送信後に長めのディレイを設けてからURLパラメータを削除する非同期処理を実装しています。

## セットアップ手順
1. 本リポジトリをローカルにクローン、または `gemini-query-param` フォルダを作成します。
2. Chromeのアドレスバーに `chrome://extensions/` を入力して開きます。
3. 右上の 「デベロッパー モード」 をONにします。
4. 左上の 「パッケージ化されていない拡張機能を読み込む」 ボタンを押し、`gemini-query-param` フォルダを選択します。

## Raycastの設定
Raycastの **Create Quicklink** で以下の通り設定してください。

| 項目 | 設定値 |
| :--- | :--- |
| **Link** | `https://gemini.google.com/app?q={argument}` |
| **Open With** | Google Chrome |

## ファイル構成
```text
gemini-query-param/
├── manifest.json  # 拡張機能の設定（Manifest V3）
├── content.js     # プロンプト注入・自動リトライ送信ロジック
└── README.md      # 本ファイル